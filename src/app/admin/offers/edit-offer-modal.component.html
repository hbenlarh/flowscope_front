<form [formGroup]="offerForm" (ngSubmit)="onSubmit()">
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <div *ngIf="!loading">
    <!-- Basic Information -->
    <h6 class="mb-3">Basic Information</h6>
    <div class="row g-3 mb-4">
      <div class="col-md-6">
        <label class="form-label">Name *</label>
        <input type="text" formControlName="name" class="form-control form-control-sm" placeholder="e.g., ChatBot AI" />
      </div>
      <div class="col-md-6">
        <label class="form-label">Category *</label>
        <select class="form-select form-select-sm" formControlName="category_id">
          <option value="">Select a category</option>
          <optgroup *ngFor="let container of containers" [attr.label]="container.name">
            <option *ngFor="let cat of container.categories" [value]="cat.category_id">{{ cat.name }}</option>
          </optgroup>
        </select>
      </div>
      <div class="col-md-6">
        <label class="form-label">Subtitle</label>
        <input type="text" formControlName="subtitle" class="form-control form-control-sm" placeholder="Short tagline (optional)" />
      </div>
      <div class="col-md-6">
        <label class="form-label">URL Slug *</label>
        <input type="text" formControlName="slug" class="form-control form-control-sm" placeholder="e.g., chatbot-ai" readonly />
      </div>
      <div class="col-12">
        <label class="form-label">Short Description *</label>
        <textarea formControlName="description" class="form-control form-control-sm" rows="2" placeholder="Brief overview"></textarea>
      </div>
      <div class="col-12">
        <label class="form-label">Detailed Description</label>
        <div class="editor-toolbar">
          <button type="button" (click)="formatText('bold')" class="btn btn-sm btn-outline-secondary" title="Bold"><b>B</b></button>
          <button type="button" (click)="formatText('italic')" class="btn btn-sm btn-outline-secondary" title="Italic"><i>I</i></button>
          <button type="button" (click)="formatText('underline')" class="btn btn-sm btn-outline-secondary" title="Underline"><u>U</u></button>
          <span class="toolbar-separator"></span>
          <button type="button" (click)="formatText('insertUnorderedList')" class="btn btn-sm btn-outline-secondary" title="Bullet List">â€¢ List</button>
          <button type="button" (click)="formatText('insertOrderedList')" class="btn btn-sm btn-outline-secondary" title="Numbered List">1. List</button>
          <span class="toolbar-separator"></span>
          <button type="button" (click)="formatHeading('h3')" class="btn btn-sm btn-outline-secondary" title="Heading">H3</button>
          <button type="button" (click)="formatHeading('p')" class="btn btn-sm btn-outline-secondary" title="Paragraph">P</button>
        </div>
        <div 
          #editorContent
          contenteditable="true" 
          class="editor-content form-control form-control-sm" 
          style="min-height: 150px;"
          (input)="onEditorInput($event)"
          [innerHTML]="offerForm.get('long_description')?.value || ''"
          placeholder="Full description...">
        </div>
      </div>
      <div class="col-md-6">
        <label class="form-label">Website URL *</label>
        <input type="url" formControlName="url" class="form-control form-control-sm" placeholder="https://example.com" />
      </div>
      <div class="col-md-3">
        <label class="form-label">Ranking</label>
        <input type="number" formControlName="ranking" class="form-control form-control-sm" placeholder="0" />
      </div>
      <div class="col-md-3">
        <label class="form-label">Verified</label>
        <select class="form-select form-select-sm" formControlName="is_verified">
          <option [value]="false">No</option>
          <option [value]="true">Yes</option>
        </select>
      </div>
    </div>

    <!-- Images -->
    <h6 class="mb-3">Images</h6>
    <div class="row g-3 mb-4">
      <div class="col-md-6">
        <label class="form-label">Logo Icon</label>
        <input type="file" (change)="onFileSelected($event)" class="form-control form-control-sm" accept="image/*" />
        <div *ngIf="currentLogoUrl" class="mt-2">
          <img [src]="currentLogoUrl" alt="Logo" style="max-width: 80px; max-height: 80px;" />
        </div>
      </div>
      <div class="col-md-6">
        <label class="form-label">Screenshot</label>
        <input type="file" (change)="onScreenshotSelected($event)" class="form-control form-control-sm" accept="image/*" />
        <div *ngIf="screenshotPreview || currentScreenshotUrl" class="mt-2">
          <img [src]="screenshotPreview || currentScreenshotUrl" alt="Screenshot" style="max-width: 150px; max-height: 100px;" />
        </div>
      </div>
    </div>

    <!-- Features -->
    <h6 class="mb-3">Features</h6>
    <div class="mb-4">
      <div *ngFor="let feature of features; let i = index" class="mb-2 p-2 border rounded">
        <div class="row g-2">
          <div class="col-md-1">
            <input type="text" [(ngModel)]="feature.icon" [ngModelOptions]="{standalone: true}" class="form-control form-control-sm" placeholder="ðŸš€" />
          </div>
          <div class="col-md-4">
            <input type="text" [(ngModel)]="feature.title" [ngModelOptions]="{standalone: true}" class="form-control form-control-sm" placeholder="Title" />
          </div>
          <div class="col-md-6">
            <input type="text" [(ngModel)]="feature.description" [ngModelOptions]="{standalone: true}" class="form-control form-control-sm" placeholder="Description" />
          </div>
          <div class="col-md-1">
            <button type="button" class="btn btn-danger btn-sm" (click)="removeFeature(i)">Ã—</button>
          </div>
        </div>
      </div>
      <button type="button" class="btn btn-sm btn-outline-primary" (click)="addFeature()">+ Add Feature</button>
    </div>

    <!-- Pros & Cons -->
    <div class="row g-3 mb-4">
      <div class="col-md-6">
        <h6 class="mb-3">Advantages</h6>
        <div *ngFor="let pro of pros; let i = index" class="mb-2">
          <div class="input-group input-group-sm">
            <input type="text" [(ngModel)]="pros[i]" [ngModelOptions]="{standalone: true}" class="form-control" placeholder="Advantage" />
            <button type="button" class="btn btn-outline-danger" (click)="removePro(i)">Ã—</button>
          </div>
        </div>
        <button type="button" class="btn btn-sm btn-outline-success" (click)="addPro()">+ Add</button>
      </div>
      <div class="col-md-6">
        <h6 class="mb-3">Disadvantages</h6>
        <div *ngFor="let con of cons; let i = index" class="mb-2">
          <div class="input-group input-group-sm">
            <input type="text" [(ngModel)]="cons[i]" [ngModelOptions]="{standalone: true}" class="form-control" placeholder="Disadvantage" />
            <button type="button" class="btn btn-outline-danger" (click)="removeCon(i)">Ã—</button>
          </div>
        </div>
        <button type="button" class="btn btn-sm btn-outline-success" (click)="addCon()">+ Add</button>
      </div>
    </div>

    <!-- Pricing - Hidden -->
    <!-- <h6 class="mb-3">Pricing Plans</h6>
    <div class="mb-4">
      <div *ngFor="let tier of pricingTiers; let i = index" class="mb-3 p-2 border rounded">
        <div class="row g-2 mb-2">
          <div class="col-md-3">
            <input type="text" [(ngModel)]="tier.name" [ngModelOptions]="{standalone: true}" class="form-control form-control-sm" placeholder="Plan name" />
          </div>
          <div class="col-md-2">
            <input type="number" [(ngModel)]="tier.price" [ngModelOptions]="{standalone: true}" class="form-control form-control-sm" placeholder="Price" />
          </div>
          <div class="col-md-6">
            <input type="text" [(ngModel)]="tier.description" [ngModelOptions]="{standalone: true}" class="form-control form-control-sm" placeholder="Description" />
          </div>
          <div class="col-md-1">
            <button type="button" class="btn btn-danger btn-sm" (click)="removePricingTier(i)">Ã—</button>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <textarea [(ngModel)]="tier.featuresText" [ngModelOptions]="{standalone: true}" class="form-control form-control-sm" rows="2" placeholder="Features (comma-separated)"></textarea>
          </div>
        </div>
      </div>
      <button type="button" class="btn btn-sm btn-outline-primary" (click)="addPricingTier()">+ Add Plan</button>
    </div> -->

    <input type="hidden" formControlName="file_name" />
    <input type="hidden" formControlName="file_base64" />
    <input type="hidden" formControlName="screenshot_url" />
    <input type="hidden" formControlName="features" />
    <input type="hidden" formControlName="pros" />
    <input type="hidden" formControlName="cons" />
    <input type="hidden" formControlName="pricing_tiers" />

    <div class="mt-4 d-flex gap-2">
      <button type="submit" class="btn btn-primary" [disabled]="!offerForm.valid || saving">
        {{ saving ? 'Saving...' : 'Save Changes' }}
      </button>
      <button type="button" class="btn btn-secondary" (click)="cancel()">Cancel</button>
    </div>
  </div>
</form>
